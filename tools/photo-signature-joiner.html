<!DOCTYPE html>
<html lang="en-GB">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Photo Signature Joiner Online Free - Merge Photo and Signature</title>
    <meta name="description" content="Photo Signature Joiner Online Free. Merge Photo and Signature into One Image. Set Standard Sizes, Compress to KB. Perfect for Government Forms. JPG PNG Supported.">
    <meta name="keywords" content="photo signature joiner, merge photo and signature, join photo signature online, photo sign combiner, government form photo signature">
    <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">
    <link rel="canonical" href="https://tools.rojgarsangam.in/tools/photo-signature-joiner.html">
    <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script type="application/ld+json">{"@context":"https://schema.org","@type":"WebApplication","name":"Photo Signature Joiner Online Free","url":"https://tools.rojgarsangam.in/tools/photo-signature-joiner.html","description":"Merge Photo and Signature into One Image Online Free.","applicationCategory":"UtilitiesApplication","operatingSystem":"Any","offers":{"@type":"Offer","price":"0","priceCurrency":"USD"}}</script>
    <script type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Home","item":"https://tools.rojgarsangam.in/"},{"@type":"ListItem","position":2,"name":"Tools","item":"https://tools.rojgarsangam.in/tools/"},{"@type":"ListItem","position":3,"name":"Photo Signature Joiner","item":"https://tools.rojgarsangam.in/tools/photo-signature-joiner.html"}]}</script>
    <script type="application/ld+json">{"@context":"https://schema.org","@type":"FAQPage","mainEntity":[{"@type":"Question","name":"How to Join Photo and Signature?","acceptedAnswer":{"@type":"Answer","text":"Upload your photo and signature, set sizes, choose target KB if needed and click Join Now. Download the merged image instantly."}},{"@type":"Question","name":"Which Sizes Are Available for Photo?","acceptedAnswer":{"@type":"Answer","text":"Passport Photo, UPSC/SSC/Bank Photo, Railway/Police Photo, Stamp Size, Custom Size and Original Size are available."}},{"@type":"Question","name":"Is My Image Safe?","acceptedAnswer":{"@type":"Answer","text":"Yes, all processing happens locally in your browser. Your images never leave your device."}},{"@type":"Question","name":"Can I Compress the Joined Image to a Specific KB?","acceptedAnswer":{"@type":"Answer","text":"Yes, select a target KB from the buttons or enter a custom value. The tool auto-adjusts quality to match your target."}}]}</script>
    <script type="application/ld+json">{"@context":"https://schema.org","@type":"HowTo","name":"How to Join Photo and Signature Online","step":[{"@type":"HowToStep","position":1,"name":"Upload Photo","text":"Click Upload and select your photo."},{"@type":"HowToStep","position":2,"name":"Upload Signature","text":"Click Upload and select your signature image."},{"@type":"HowToStep","position":3,"name":"Set Sizes","text":"Choose photo size, signature size and target file size."},{"@type":"HowToStep","position":4,"name":"Download","text":"Click Join Now and download the merged image."}]}</script>

    <style>
        body{font-family:'Lora',serif!important;background:#f8f8ff;color:#333}
        #header-placeholder{background-color:#fff!important;width:100%;display:block;position:relative;z-index:1000}
        .section-main{margin:40px 0px 40px 0px!important}
        .tool-wrapper{background:#fff;border-radius:20px;padding:40px 40px 40px 40px;box-shadow:0px 4px 20px rgba(0,0,0,0.08);border:1px solid #667799}

        .upload-grid{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin:0px 0px 30px 0px}
        .upload-box{border:3px dashed #667799;border-radius:14px;padding:28px 16px 28px 16px;text-align:center;cursor:pointer;background:#f8f8ff;transition:all .3s;position:relative}
        .upload-box:hover,.upload-box.dragover{border-color:#00079e;background:#fdece5}
        .upload-box.has-file{border-color:#00c853;border-style:solid;background:#eff6ef}
        .upload-box-icon{font-size:32px;color:#00079e;margin:0px 0px 10px 0px}
        .upload-box-title{font-size:15px;font-weight:700;color:#333;margin:0px 0px 5px 0px}
        .upload-box-sub{font-size:12px;color:#667799;margin:0px 0px 0px 0px}
        .upload-thumb{width:100%;max-height:140px;object-fit:contain;border-radius:6px;margin:10px 0px 0px 0px;display:none}
        .upload-badge{display:none;background:#eff6ef;border:1px solid #667799;border-radius:6px;padding:4px 8px 4px 8px;font-size:11px;font-weight:700;color:#00079e;margin:8px 0px 0px 0px}

        .settings-wrapper{background:#f8f8ff;border:1px solid #667799;border-radius:14px;padding:24px 24px 24px 24px;margin:0px 0px 0px 0px}
        .settings-title{font-size:16px;font-weight:900;color:#333;margin:0px 0px 18px 0px;display:flex;align-items:center;gap:8px}
        .settings-title i{color:#00079e}

        .settings-grid{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin:0px 0px 20px 0px}
        .form-group{margin:0px 0px 0px 0px}
        .form-group label{display:flex;align-items:center;gap:7px;font-size:13px;font-weight:700;color:#333;margin:0px 0px 8px 0px}
        .form-group label i{color:#00079e;font-size:12px}
        .form-select{width:100%;padding:10px 12px 10px 12px;border:2px solid #bdbdbd;border-radius:8px;font-size:13px;font-family:'Lora',serif;color:#333;background:#fff;box-sizing:border-box;cursor:pointer;transition:border .2s}
        .form-select:focus{outline:none;border-color:#00079e}
        .form-input{width:100%;padding:10px 12px 10px 12px;border:2px solid #bdbdbd;border-radius:8px;font-size:13px;font-family:'Lora',serif;color:#333;background:#fff;box-sizing:border-box;transition:border .2s}
        .form-input:focus{outline:none;border-color:#00079e;background:#fff}

        .custom-row{display:none;margin:10px 0px 0px 0px}
        .custom-row-inner{display:flex;gap:10px}
        .custom-row-inner .form-input{margin:0px 0px 0px 0px}

        .divider{height:1px;background:#bdbdbd;margin:20px 0px 20px 0px}

        .gap-options{display:flex;gap:8px;flex-wrap:wrap;margin:0px 0px 0px 0px}
        .gap-btn{padding:8px 14px 8px 14px;background:#f8f8ff;border:2px solid #bdbdbd;border-radius:8px;font-size:13px;font-weight:700;color:#333;cursor:pointer;font-family:'Lora',serif;transition:all .2s}
        .gap-btn:hover,.gap-btn.active{background:#eff6ef;border-color:#00079e;color:#00079e}

        .kb-section-label{font-size:13px;font-weight:700;color:#333;margin:0px 0px 10px 0px;display:flex;align-items:center;gap:6px}
        .kb-section-label i{color:#00079e}
        .kb-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin:0px 0px 10px 0px}
        .kb-btn{padding:9px 6px 9px 6px;background:#f8f8ff;border:2px solid #bdbdbd;border-radius:8px;font-size:12px;font-weight:700;color:#333;cursor:pointer;font-family:'Lora',serif;transition:all .2s;text-align:center}
        .kb-btn:hover,.kb-btn.active{background:#eff6ef;border-color:#00079e;color:#00079e}

        .join-btn{width:100%;padding:17px 0px 17px 0px;background:#00079e;color:#fff;border:none;border-radius:50px;font-size:17px;font-weight:700;cursor:pointer;margin:22px 0px 0px 0px;transition:all .3s;font-family:'Lora',serif;display:flex;align-items:center;justify-content:center;gap:10px}
        .join-btn:hover{background:#333;transform:translateY(-2px)}

        .result-container{display:none}
        .result-container.active{display:flex;gap:30px;margin:30px 0px 0px 0px;align-items:flex-start}
        .result-canvas-wrap{flex:1;background:#fff;border-radius:12px;border:1px solid #667799;padding:20px 20px 20px 20px;display:flex;flex-direction:column;align-items:center}
        #outputCanvas{max-width:100%;height:auto;display:block;border:2px solid #bdbdbd;border-radius:4px}
        .img-info{width:100%;margin:14px 0px 0px 0px;display:flex;gap:8px;flex-wrap:wrap}
        .info-badge{background:#eff6ef;border:1px solid #667799;border-radius:6px;padding:5px 10px 5px 10px;font-size:12px;font-weight:700;color:#333}
        .info-badge span{color:#00079e}

        .result-info-panel{width:380px;background:#fff;border:1px solid #667799;border-radius:12px;padding:25px 25px 25px 25px;height:fit-content;position:sticky;top:100px}
        .result-success{text-align:center;margin:0px 0px 22px 0px}
        .result-icon{font-size:52px;color:#00c853;margin:0px 0px 10px 0px}
        .result-title{font-size:22px;font-weight:900;color:#333;margin:0px 0px 5px 0px}
        .result-sub{font-size:13px;color:#667799;margin:0px 0px 0px 0px}
        .result-stats{display:flex;flex-direction:column;gap:10px;margin:0px 0px 22px 0px}
        .stat-row{display:flex;justify-content:space-between;align-items:center;padding:10px 14px 10px 14px;background:#f8f8ff;border:1px solid #bdbdbd;border-radius:8px}
        .stat-label{font-size:12px;color:#667799;font-weight:700}
        .stat-value{font-size:12px;color:#00079e;font-weight:700}

        .download-btn{width:100%;padding:16px 0px 16px 0px;background:#eff6ef;color:#00079e;border:1px solid #667799;border-radius:50px;font-size:16px;font-weight:700;cursor:pointer;transition:all .3s;font-family:'Lora',serif;display:flex;align-items:center;justify-content:center;gap:8px}
        .download-btn:hover{background:#fdece5;transform:translateY(-2px)}
        .reset-btn{width:100%;padding:12px 0px 12px 0px;background:#f8f8ff;color:#667799;border:1px solid #bdbdbd;border-radius:50px;font-size:14px;font-weight:700;cursor:pointer;margin:10px 0px 0px 0px;transition:all .3s;font-family:'Lora',serif;display:flex;align-items:center;justify-content:center;gap:8px}
        .reset-btn:hover{background:#fdece5;color:#00079e;border-color:#00079e}

        .error-msg{display:none;background:#fdece5;border:1px solid #e53935;border-radius:8px;padding:10px 16px 10px 16px;font-size:13px;font-weight:700;color:#e53935;margin:0px 0px 16px 0px}
        .error-msg.show{display:block}

        .processing-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(248,248,255,0.95);display:none;align-items:center;justify-content:center;z-index:9999}
        .processing-overlay.active{display:flex}
        .processing-box{background:#fff;border-radius:20px;padding:50px 50px 50px 50px;text-align:center;max-width:420px;width:90%;border:1px solid #667799;box-shadow:0px 20px 60px rgba(0,0,0,0.15)}
        .processing-icon{font-size:60px;color:#00079e;margin:0px 0px 20px 0px;animation:spin 1s linear infinite}
        @keyframes spin{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}
        .processing-title{font-size:24px;font-weight:900;color:#333;margin:0px 0px 10px 0px}
        .processing-text{font-size:14px;color:#00079e;background:#eff6ef;padding:10px 15px 10px 15px;border-radius:8px;border:1px solid #667799;font-weight:700;margin:0px 0px 0px 0px}

        #footer-placeholder{border:1px solid #667799!important;width:100%;display:block;position:relative}

        @media(max-width:1024px){.result-container.active{flex-direction:column}.result-info-panel{width:100%;position:static}}
        @media(max-width:600px){
            .tool-wrapper{padding:22px 18px 22px 18px}
            .upload-grid{grid-template-columns:1fr}
            .settings-grid{grid-template-columns:1fr}
            .kb-grid{grid-template-columns:repeat(3,1fr)}
        }
    </style>
</head>
<body>
    <div id="header-placeholder"></div>

    <section class="section" style="margin:50px 0px 0px 0px!important">
        <div class="row-container">
            <div class="ad-manager-placeholder ad-leaderboard" data-ad-type="leaderboard"></div>
        </div>
    </section>

    <section class="section-main">
        <div class="row-container">

            <div style="text-align:center;margin:0px 0px 30px 0px">
                <h1 style="font-size:36px;font-weight:900;color:#333;margin:0px 0px 10px 0px">Photo Signature Joiner Online Free</h1>
                <p style="font-size:16px;color:#333;margin:0px 0px 0px 0px">Merge Photo and Signature into One Image. Set Standard Sizes, Compress to Exact KB. Perfect for Government Forms and Applications.</p>
            </div>

            <div class="tool-wrapper">

                <div id="errorMsg" class="error-msg"><i class="fas fa-exclamation-circle"></i> <span id="errorText"></span></div>

                <!-- UPLOAD GRID -->
                <div class="upload-grid">
                    <div class="upload-box" id="photoBox">
                        <div class="upload-box-icon"><i class="fas fa-portrait"></i></div>
                        <div class="upload-box-title">Upload Photo</div>
                        <div class="upload-box-sub">JPG, PNG, WebP</div>
                        <img id="photoThumb" class="upload-thumb" alt="Photo Preview">
                        <div id="photoBadge" class="upload-badge"></div>
                        <input type="file" id="photoInput" accept="image/jpeg,image/png,image/webp" style="display:none">
                    </div>
                    <div class="upload-box" id="signBox">
                        <div class="upload-box-icon"><i class="fas fa-pen-nib"></i></div>
                        <div class="upload-box-title">Upload Signature</div>
                        <div class="upload-box-sub">JPG, PNG, WebP</div>
                        <img id="signThumb" class="upload-thumb" alt="Signature Preview">
                        <div id="signBadge" class="upload-badge"></div>
                        <input type="file" id="signInput" accept="image/jpeg,image/png,image/webp" style="display:none">
                    </div>
                </div>

                <!-- SETTINGS -->
                <div class="settings-wrapper">
                    <div class="settings-title"><i class="fas fa-sliders-h"></i> Size & Output Settings</div>

                    <div class="settings-grid">
                        <div>
                            <div class="form-group" style="margin:0px 0px 14px 0px">
                                <label><i class="fas fa-portrait"></i> Photo Size</label>
                                <select id="photoSize" class="form-select">
                                    <option value="original">Original Size</option>
                                    <optgroup label="Government Forms">
                                        <option value="413x531">Passport Photo (413×531 px)</option>
                                        <option value="200x230">UPSC / SSC / Bank (200×230 px)</option>
                                        <option value="400x500">Railway / Police (400×500 px)</option>
                                        <option value="200x200">Stamp Size (200×200 px)</option>
                                    </optgroup>
                                    <optgroup label="Print">
                                        <option value="1200x1800">4R Print (1200×1800 px)</option>
                                    </optgroup>
                                    <option value="custom">Custom Size</option>
                                </select>
                            </div>
                            <div class="custom-row" id="photoCustomRow">
                                <div class="custom-row-inner">
                                    <input type="number" id="photoCustomW" class="form-input" placeholder="W (px)" min="1">
                                    <input type="number" id="photoCustomH" class="form-input" placeholder="H (px)" min="1">
                                </div>
                            </div>
                        </div>

                        <div>
                            <div class="form-group" style="margin:0px 0px 14px 0px">
                                <label><i class="fas fa-pen-nib"></i> Signature Size</label>
                                <select id="signSize" class="form-select">
                                    <option value="original">Original Size</option>
                                    <optgroup label="Standard">
                                        <option value="140x60">Standard Signature (140×60 px)</option>
                                        <option value="200x80">Wide Signature (200×80 px)</option>
                                        <option value="280x120">Large Signature (280×120 px)</option>
                                    </optgroup>
                                    <option value="custom">Custom Size</option>
                                </select>
                            </div>
                            <div class="custom-row" id="signCustomRow">
                                <div class="custom-row-inner">
                                    <input type="number" id="signCustomW" class="form-input" placeholder="W (px)" min="1">
                                    <input type="number" id="signCustomH" class="form-input" placeholder="H (px)" min="1">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="divider"></div>

                    <div class="form-group" style="margin:0px 0px 18px 0px">
                        <label><i class="fas fa-arrows-alt-v"></i> Gap Between Photo & Signature</label>
                        <div class="gap-options">
                            <button class="gap-btn active" data-gap="0">No Gap</button>
                            <button class="gap-btn" data-gap="5">5 px</button>
                            <button class="gap-btn" data-gap="10">10 px</button>
                            <button class="gap-btn" data-gap="20">20 px</button>
                            <button class="gap-btn" data-gap="30">30 px</button>
                        </div>
                    </div>

                    <div class="divider"></div>

                    <div class="kb-section-label"><i class="fas fa-file-image"></i> Target File Size (Optional)</div>
                    <div class="kb-grid">
                        <button class="kb-btn" data-kb="10">10 KB</button>
                        <button class="kb-btn" data-kb="20">20 KB</button>
                        <button class="kb-btn" data-kb="30">30 KB</button>
                        <button class="kb-btn" data-kb="50">50 KB</button>
                        <button class="kb-btn" data-kb="100">100 KB</button>
                        <button class="kb-btn" data-kb="120">120 KB</button>
                        <button class="kb-btn" data-kb="150">150 KB</button>
                        <button class="kb-btn" data-kb="200">200 KB</button>
                    </div>
                    <input type="number" id="customKbInput" class="form-input" placeholder="Or enter custom KB e.g. 75" min="1" style="margin:0px 0px 0px 0px">
                </div>

                <button class="join-btn" id="joinBtn">
                    <i class="fas fa-link"></i> Join Now
                </button>

                <!-- RESULT -->
                <div id="resultSection" class="result-container">
                    <div class="result-canvas-wrap">
                        <canvas id="outputCanvas"></canvas>
                        <div class="img-info">
                            <div class="info-badge">Output Size: <span id="outSize">-</span></div>
                            <div class="info-badge">Dimensions: <span id="outDims">-</span></div>
                        </div>
                    </div>
                    <div class="result-info-panel">
                        <div class="result-success">
                            <div class="result-icon"><i class="fas fa-check-circle"></i></div>
                            <div class="result-title">Images Joined!</div>
                            <div class="result-sub">Your merged image is ready to download.</div>
                        </div>
                        <div class="result-stats">
                            <div class="stat-row"><span class="stat-label">Photo Size</span><span class="stat-value" id="statPhoto">-</span></div>
                            <div class="stat-row"><span class="stat-label">Signature Size</span><span class="stat-value" id="statSign">-</span></div>
                            <div class="stat-row"><span class="stat-label">Total Dimensions</span><span class="stat-value" id="statDims">-</span></div>
                            <div class="stat-row"><span class="stat-label">File Size</span><span class="stat-value" id="statFile">-</span></div>
                        </div>
                        <button class="download-btn" id="downloadBtn"><i class="fas fa-download"></i> Download Joined Image</button>
                        <button class="reset-btn" id="joinAgainBtn"><i class="fas fa-redo"></i> Join Another</button>
                    </div>
                </div>

            </div>
        </div>
    </section>

    <section class="section-container" style="margin:40px 0px 40px 0px!important;padding:0px 0px 0px 0px!important">
        <div class="row-container">
            <h2 style="font-weight:900;margin:0px 0px 25px 0px!important;text-align:center!important;color:#333">How to Join Photo and Signature Online</h2>
            <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:20px;margin:0px 0px 0px 0px">
                <div style="background:#fff;border:1px solid #667799;border-radius:12px;padding:24px 20px 24px 20px;text-align:center"><div style="font-size:36px;color:#00079e;margin:0px 0px 12px 0px"><i class="fas fa-portrait"></i></div><div style="font-size:16px;font-weight:700;color:#333;margin:0px 0px 8px 0px">Step 1: Upload Photo</div><div style="font-size:13px;color:#667799">Click the photo box and upload your passport or form photo.</div></div>
                <div style="background:#fff;border:1px solid #667799;border-radius:12px;padding:24px 20px 24px 20px;text-align:center"><div style="font-size:36px;color:#00079e;margin:0px 0px 12px 0px"><i class="fas fa-pen-nib"></i></div><div style="font-size:16px;font-weight:700;color:#333;margin:0px 0px 8px 0px">Step 2: Upload Signature</div><div style="font-size:13px;color:#667799">Click the signature box and upload your scanned signature.</div></div>
                <div style="background:#fff;border:1px solid #667799;border-radius:12px;padding:24px 20px 24px 20px;text-align:center"><div style="font-size:36px;color:#00079e;margin:0px 0px 12px 0px"><i class="fas fa-sliders-h"></i></div><div style="font-size:16px;font-weight:700;color:#333;margin:0px 0px 8px 0px">Step 3: Set Sizes</div><div style="font-size:13px;color:#667799">Choose photo and signature sizes. Set gap and target file size in KB if needed.</div></div>
                <div style="background:#fff;border:1px solid #667799;border-radius:12px;padding:24px 20px 24px 20px;text-align:center"><div style="font-size:36px;color:#00079e;margin:0px 0px 12px 0px"><i class="fas fa-download"></i></div><div style="font-size:16px;font-weight:700;color:#333;margin:0px 0px 8px 0px">Step 4: Download</div><div style="font-size:13px;color:#667799">Click Join Now, preview the result and download as JPG.</div></div>
            </div>
        </div>
    </section>

    <section class="section-container" style="margin:40px 0px 40px 0px!important;padding:0px 0px 0px 0px!important">
        <div class="row-container">
            <h2 style="font-weight:900;margin:0px 0px 25px 0px!important;text-align:center!important;color:#333">Frequently Asked Questions</h2>
            <div class="faq-list">
                <div class="faq-item"><div class="faq-question" onclick="toggleFAQ(this)"><span>How to Join Photo and Signature Online?</span><i class="faq-icon">+</i></div><div class="faq-answer"><p>Upload your photo and signature, set the required sizes, choose a target file size in KB if needed and click Join Now. Download the merged image instantly.</p></div></div>
                <div class="faq-item"><div class="faq-question" onclick="toggleFAQ(this)"><span>Which Photo Sizes Are Available?</span><i class="faq-icon">+</i></div><div class="faq-answer"><p>Passport Photo, UPSC/SSC/Bank Photo, Railway/Police Photo, Stamp Size, Custom Size and Original Size are available for standard government form requirements.</p></div></div>
                <div class="faq-item"><div class="faq-question" onclick="toggleFAQ(this)"><span>Can I Compress the Joined Image to a Specific KB?</span><i class="faq-icon">+</i></div><div class="faq-answer"><p>Yes, select a target file size like 20KB, 50KB or 100KB from the buttons or enter a custom KB value. The tool automatically adjusts quality to match your target size.</p></div></div>
                <div class="faq-item"><div class="faq-question" onclick="toggleFAQ(this)"><span>Is My Photo and Signature Safe?</span><i class="faq-icon">+</i></div><div class="faq-answer"><p>Yes, all processing happens locally in your browser. Your photos and signatures are never uploaded to any server and remain completely private on your device.</p></div></div>
                <div class="faq-item"><div class="faq-question" onclick="toggleFAQ(this)"><span>Can I Use This for Government Form Applications?</span><i class="faq-icon">+</i></div><div class="faq-answer"><p>Yes, this tool is specifically designed for government and job application forms that require a separate photo and signature merged into one single image file.</p></div></div>
            </div>
        </div>
    </section>

    <section class="section-main">
        <div class="row-custom">
            <div class="ad-manager-placeholder" data-ad-type="responsive"></div>
        </div>
    </section>

    <div id="processingOverlay" class="processing-overlay">
        <div class="processing-box">
            <div class="processing-icon"><i class="fas fa-cog"></i></div>
            <div class="processing-title">Joining Images</div>
            <div class="processing-text">Please Wait. Merging Photo and Signature...</div>
        </div>
    </div>

    <div id="footer-placeholder"></div>
    <script src="../js/ad-manager.js"></script>
    <script src="../js/main.js"></script>

    <script>
    let photoImg   = null;
    let signImg    = null;
    let selectedKB = null;
    let gapValue   = 0;

    const errorMsg  = document.getElementById('errorMsg');
    const errorText = document.getElementById('errorText');

    function showError(msg) { errorText.textContent = msg; errorMsg.classList.add('show'); window.scrollTo({top:0,behavior:'smooth'}); }
    function hideError()    { errorMsg.classList.remove('show'); }

    function fmtKB(kb) {
        if (kb >= 1024) return (kb / 1024).toFixed(2) + ' MB';
        return kb.toFixed(1) + ' KB';
    }
    function b64KB(b64) { return (b64.split(',')[1].length * 0.75) / 1024; }

    function loadImgFile(file) {
        return new Promise((res, rej) => {
            const reader  = new FileReader();
            reader.onload = ev => {
                const img  = new Image();
                img.onload = () => res(img);
                img.onerror = rej;
                img.src    = ev.target.result;
            };
            reader.readAsDataURL(file);
        });
    }

    function setupUploadBox(boxId, inputId, thumbId, badgeId, onLoad) {
        const box   = document.getElementById(boxId);
        const input = document.getElementById(inputId);
        const thumb = document.getElementById(thumbId);
        const badge = document.getElementById(badgeId);

        box.addEventListener('click', () => input.click());
        box.addEventListener('dragover',  e => { e.preventDefault(); box.classList.add('dragover'); });
        box.addEventListener('dragleave', () => box.classList.remove('dragover'));
        box.addEventListener('drop', e => {
            e.preventDefault(); box.classList.remove('dragover');
            const f = Array.from(e.dataTransfer.files).find(f => /^image\/(jpeg|png|webp)$/.test(f.type));
            if (f) processFile(f);
        });
        input.addEventListener('change', e => { if (e.target.files[0]) processFile(e.target.files[0]); input.value = ''; });

        async function processFile(file) {
            const img    = await loadImgFile(file);
            const sizeKB = file.size / 1024;
            thumb.src            = img.src;
            thumb.style.display  = 'block';
            badge.textContent    = fmtKB(sizeKB) + ' — ' + img.naturalWidth + '×' + img.naturalHeight + ' px';
            badge.style.display  = 'block';
            box.classList.add('has-file');
            onLoad(img);
        }
    }

    setupUploadBox('photoBox', 'photoInput', 'photoThumb', 'photoBadge', img => { photoImg = img; });
    setupUploadBox('signBox',  'signInput',  'signThumb',  'signBadge',  img => { signImg  = img; });

    document.getElementById('photoSize').addEventListener('change', function () {
        document.getElementById('photoCustomRow').style.display = this.value === 'custom' ? 'block' : 'none';
    });
    document.getElementById('signSize').addEventListener('change', function () {
        document.getElementById('signCustomRow').style.display = this.value === 'custom' ? 'block' : 'none';
    });

    document.querySelectorAll('.gap-btn').forEach(btn => {
        btn.addEventListener('click', function () {
            document.querySelectorAll('.gap-btn').forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            gapValue = parseInt(this.dataset.gap);
        });
    });

    document.querySelectorAll('.kb-btn').forEach(btn => {
        btn.addEventListener('click', function () {
            document.querySelectorAll('.kb-btn').forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            selectedKB = parseInt(this.dataset.kb);
            document.getElementById('customKbInput').value = '';
        });
    });
    document.getElementById('customKbInput').addEventListener('input', () => {
        document.querySelectorAll('.kb-btn').forEach(b => b.classList.remove('active'));
        selectedKB = null;
    });

    function getDims(selectId, customWId, customHId, img) {
        const val = document.getElementById(selectId).value;
        if (val === 'original') return { w: img.naturalWidth, h: img.naturalHeight };
        if (val === 'custom') {
            return {
                w: parseInt(document.getElementById(customWId).value) || img.naturalWidth,
                h: parseInt(document.getElementById(customHId).value) || img.naturalHeight
            };
        }
        const [w, h] = val.split('x').map(Number);
        return { w, h };
    }

    document.getElementById('joinBtn').addEventListener('click', async () => {
        hideError();
        if (!photoImg) { showError('Please upload a Photo.'); return; }
        if (!signImg)  { showError('Please upload a Signature.'); return; }

        const photoSizeVal = document.getElementById('photoSize').value;
        const signSizeVal  = document.getElementById('signSize').value;

        if (photoSizeVal === 'custom') {
            const pw = parseInt(document.getElementById('photoCustomW').value);
            const ph = parseInt(document.getElementById('photoCustomH').value);
            if (!pw || !ph) { showError('Please enter Custom Width and Height for Photo.'); return; }
        }
        if (signSizeVal === 'custom') {
            const sw = parseInt(document.getElementById('signCustomW').value);
            const sh = parseInt(document.getElementById('signCustomH').value);
            if (!sw || !sh) { showError('Please enter Custom Width and Height for Signature.'); return; }
        }

        document.getElementById('processingOverlay').classList.add('active');
        await new Promise(r => setTimeout(r, 80));

        try {
            const pDims = getDims('photoSize', 'photoCustomW', 'photoCustomH', photoImg);
            const sDims = getDims('signSize',  'signCustomW',  'signCustomH',  signImg);

            const canvasW = Math.max(pDims.w, sDims.w);
            const canvasH = pDims.h + gapValue + sDims.h;

            const outputCanvas = document.getElementById('outputCanvas');
            outputCanvas.width  = canvasW;
            outputCanvas.height = canvasH;
            const ctx = outputCanvas.getContext('2d');

            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, canvasW, canvasH);

            const pOffX = Math.round((canvasW - pDims.w) / 2);
            ctx.drawImage(photoImg, pOffX, 0, pDims.w, pDims.h);

            if (gapValue > 0) {
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0, pDims.h, canvasW, gapValue);
            }

            const sOffX = Math.round((canvasW - sDims.w) / 2);
            ctx.drawImage(signImg, sOffX, pDims.h + gapValue, sDims.w, sDims.h);

            const targetKB = selectedKB || parseInt(document.getElementById('customKbInput').value) || null;
            let dataURL;

            if (targetKB && targetKB > 0) {
                let lo = 0.01, hi = 1.0, best = outputCanvas.toDataURL('image/jpeg', 0.8);
                for (let i = 0; i < 20; i++) {
                    const mid = (lo + hi) / 2;
                    const d   = outputCanvas.toDataURL('image/jpeg', mid);
                    const kb  = b64KB(d);
                    if (kb <= targetKB) { best = d; lo = mid; }
                    else hi = mid;
                    if (hi - lo < 0.005) break;
                }
                dataURL = best;
            } else {
                dataURL = outputCanvas.toDataURL('image/jpeg', 0.92);
            }

            const newSizeKB = b64KB(dataURL);

            document.getElementById('outSize').textContent  = fmtKB(newSizeKB);
            document.getElementById('outDims').textContent  = canvasW + '×' + canvasH + ' px';
            document.getElementById('statPhoto').textContent = pDims.w + '×' + pDims.h + ' px';
            document.getElementById('statSign').textContent  = sDims.w + '×' + sDims.h + ' px';
            document.getElementById('statDims').textContent  = canvasW + '×' + canvasH + ' px';
            document.getElementById('statFile').textContent  = fmtKB(newSizeKB);

            document.getElementById('downloadBtn').onclick = () => {
                const a    = document.createElement('a');
                a.href     = dataURL;
                a.download = 'photo-signature-rojgarsangam.jpg';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
            };

            document.getElementById('resultSection').classList.add('active');
            document.getElementById('resultSection').scrollIntoView({ behavior: 'smooth', block: 'start' });

        } catch(err) {
            console.error(err);
            alert('Error: ' + err.message);
        } finally {
            document.getElementById('processingOverlay').classList.remove('active');
        }
    });

    document.getElementById('joinAgainBtn').addEventListener('click', () => {
        photoImg   = null;
        signImg    = null;
        selectedKB = null;
        gapValue   = 0;

        ['photoThumb','signThumb'].forEach(id => { const el = document.getElementById(id); el.style.display='none'; el.src=''; });
        ['photoBadge','signBadge'].forEach(id => { const el = document.getElementById(id); el.style.display='none'; el.textContent=''; });
        ['photoBox','signBox'].forEach(id => document.getElementById(id).classList.remove('has-file'));
        document.getElementById('photoSize').value  = 'original';
        document.getElementById('signSize').value   = 'original';
        document.getElementById('photoCustomRow').style.display = 'none';
        document.getElementById('signCustomRow').style.display  = 'none';
        document.getElementById('customKbInput').value = '';
        document.querySelectorAll('.kb-btn').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.gap-btn').forEach(b => b.classList.remove('active'));
        document.querySelector('.gap-btn[data-gap="0"]').classList.add('active');
        document.getElementById('resultSection').classList.remove('active');
        hideError();
        window.scrollTo({ top: 0, behavior: 'smooth' });
    });
    </script>
</body>
</html>
