<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Photo Sign Joiner - Rojgar Sangam Tools</title>
    <link rel="stylesheet" href="../css/style.css">
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <header class="header-main">
        <div class="row-settings flex justify-between items-center px-4">
            <a href="../index.html"><img src="https://raw.githubusercontent.com/sanjeevkumarambn/tools/main/Rojgar%20Sangam%20HD%20Logo.png" class="h-12"></a>
        </div>
    </header>

    <main class="min-h-screen">
        <section id="screen-1" class="section-custom">
            <div class="row-settings text-center">
                <h1 class="text-3xl font-bold mb-8">Merge Photo & Signature</h1>
                <div class="bg-white p-8 rounded-xl border border-[#bdbdbd] max-w-lg mx-auto text-left">
                    <label class="block font-bold mb-1">Select Photo:</label>
                    <input type="file" id="photoIn" class="w-full border p-2 mb-4 rounded" accept="image/*">
                    
                    <label class="block font-bold mb-1">Select Signature:</label>
                    <input type="file" id="signIn" class="w-full border p-2 mb-6 rounded" accept="image/*">
                    
                    <button onclick="joinImages()" class="btn-brand w-full">Join Now</button>
                </div>
            </div>
        </section>

        <section id="screen-3" class="section-custom hidden">
            <div class="row-settings text-center py-20">
                <div class="animate-spin text-4xl text-[#00079e] mb-4"><i class="fas fa-link"></i></div>
                <h2 class="text-2xl font-bold">Joining...</h2>
            </div>
        </section>

        <section id="screen-2" class="section-custom hidden">
            <div class="row-settings text-center">
                <div class="bg-white p-10 rounded-xl border border-[#bdbdbd] max-w-lg mx-auto">
                    <canvas id="joinCanvas" class="max-w-full h-auto mb-6 mx-auto border"></canvas>
                    <a id="downloadBtn" class="btn-brand block text-center">Download Joined Image</a>
                    <button onclick="location.reload()" class="mt-4 text-sm underline">Try Again</button>
                </div>
            </div>
        </section>
    </main>

    <script>
        async function joinImages() {
            const photoFile = document.getElementById('photoIn').files[0];
            const signFile = document.getElementById('signIn').files[0];

            if(!photoFile || !signFile) return alert("Select both files");

            document.getElementById('screen-1').classList.add('hidden');
            document.getElementById('screen-3').classList.remove('hidden');

            const pImg = await loadImage(photoFile);
            const sImg = await loadImage(signFile);

            const canvas = document.getElementById('joinCanvas');
            const ctx = canvas.getContext('2d');

            const targetW = 350;
            const pScale = targetW / pImg.width;
            const sScale = targetW / sImg.width;

            canvas.width = targetW;
            canvas.height = (pImg.height * pScale) + (sImg.height * sScale) + 10;

            ctx.fillStyle = "white";
            ctx.fillRect(0,0,canvas.width, canvas.height);
            ctx.drawImage(pImg, 0, 0, targetW, pImg.height * pScale);
            ctx.drawImage(sImg, 0, (pImg.height * pScale) + 10, targetW, sImg.height * sScale);

            const url = canvas.toDataURL('image/jpeg', 0.9);
            document.getElementById('downloadBtn').href = url;
            document.getElementById('downloadBtn').download = "joined-rojgar-sangam.jpg";
            
            setTimeout(() => {
                document.getElementById('screen-3').classList.add('hidden');
                document.getElementById('screen-2').classList.remove('hidden');
            }, 1000);
        }

        function loadImage(file) {
            return new Promise(resolve => {
                const reader = new FileReader();
                reader.onload = e => {
                    const img = new Image();
                    img.src = e.target.result;
                    img.onload = () => resolve(img);
                };
                reader.readAsDataURL(file);
            });
        }
    </script>
</body>
</html>
