<!DOCTYPE html>
<html lang="en-GB">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Remove Image Background Online Free: 100% Automatically</title>
    <meta name="description" content="Remove Image Background Online Free. 100% Automatically in Browser. Add Custom Color, Photo Background, Blur Effects. JPG PNG WebP Supported.">
    <meta name="keywords" content="remove background, bg remover, remove image background online free, transparent background maker, photo background remover">
    <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">
    <link rel="canonical" href="https://tools.rojgarsangam.in/tools/remove-bg.html">
    <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script type="application/ld+json">{"@context":"https://schema.org","@type":"WebApplication","name":"Remove Image Background Online Free","url":"https://tools.rojgarsangam.in/tools/remove-bg.html","description":"Remove Image Background Automatically Online Free.","applicationCategory":"UtilitiesApplication","operatingSystem":"Any","offers":{"@type":"Offer","price":"0","priceCurrency":"USD"}}</script>
    <script type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Home","item":"https://tools.rojgarsangam.in/"},{"@type":"ListItem","position":2,"name":"Image Tools","item":"https://tools.rojgarsangam.in/tools/"},{"@type":"ListItem","position":3,"name":"Remove Background","item":"https://tools.rojgarsangam.in/tools/remove-bg.html"}]}</script>
    <script type="application/ld+json">{"@context":"https://schema.org","@type":"FAQPage","mainEntity":[{"@type":"Question","name":"Is This Background Removal Tool Free?","acceptedAnswer":{"@type":"Answer","text":"Yes, Completely Free with No Limitations."}},{"@type":"Question","name":"Which Image Formats are Supported?","acceptedAnswer":{"@type":"Answer","text":"JPG, PNG and WebP are Supported."}},{"@type":"Question","name":"Is My Image Safe?","acceptedAnswer":{"@type":"Answer","text":"Yes, All Processing Happens Locally in Your Browser."}},{"@type":"Question","name":"Can I Add a Custom Background?","acceptedAnswer":{"@type":"Answer","text":"Yes, Add Solid Color, Photo Background, or Blur Effect."}}]}</script>
    <script type="application/ld+json">{"@context":"https://schema.org","@type":"HowTo","name":"How to Remove Image Background Online Free","step":[{"@type":"HowToStep","position":1,"name":"Upload Image","text":"Click Upload or drag and drop your image."},{"@type":"HowToStep","position":2,"name":"AI Removes Background","text":"AI automatically removes the background in your browser."},{"@type":"HowToStep","position":3,"name":"Edit and Enhance","text":"Add custom background color or photo."},{"@type":"HowToStep","position":4,"name":"Download Image","text":"Click Download to save your image."}]}</script>

    <style>
        body{font-family:'Lora',serif!important;background:#f8f8ff;color:#333}
        #header-placeholder{background-color:#fff!important;width:100%;display:block;position:relative;z-index:1000}
        .section-main{margin:40px 0!important}
        .upload-section-wrapper{background:#fff;border-radius:20px;padding:40px;box-shadow:0 4px 20px rgba(0,0,0,.08);border:1px solid #667799}
        .upload-area{border:3px dashed #667799;border-radius:16px;padding:60px 20px;text-align:center;cursor:pointer;background:#f8f8ff;transition:all .3s;max-width:700px;margin:0 auto}
        .upload-area:hover,.upload-area.dragover{border-color:#00079e;background:#fdece5}
        .upload-icon{font-size:48px;color:#00079e;margin:0 0 20px}
        .upload-text{font-size:20px;font-weight:700;color:#333;margin:0 0 10px}
        .upload-subtext{font-size:14px;color:#667799}
        .workspace-container{display:none}
        .workspace-container.active{display:flex;gap:30px;margin:30px 0 0;align-items:flex-start}
        .preview-panel{flex:1;background:#fff;border-radius:12px;border:1px solid #667799;padding:20px;display:flex;flex-direction:column;align-items:center}
        .canvas-wrapper{width:100%;overflow:hidden;border-radius:8px;border:1px solid #bdbdbd;background-image:linear-gradient(45deg,#bdbdbd 25%,transparent 25%),linear-gradient(-45deg,#bdbdbd 25%,transparent 25%),linear-gradient(45deg,transparent 75%,#bdbdbd 75%),linear-gradient(-45deg,transparent 75%,#bdbdbd 75%);background-size:20px 20px;background-position:0 0,0 10px,10px -10px,-10px 0;background-color:#f8f8ff;cursor:grab;position:relative;height:480px;display:flex;align-items:center;justify-content:center}
        .canvas-wrapper:active{cursor:grabbing}
        #editorCanvas{max-width:100%;max-height:480px;display:block;transform-origin:0 0;touch-action:none}
        .zoom-controls{display:flex;gap:8px;margin:12px 0 0;align-items:center;justify-content:center}
        .zoom-btn{width:36px;height:36px;background:#eff6ef;border:1px solid #667799;border-radius:8px;font-size:14px;cursor:pointer;color:#00079e;display:flex;align-items:center;justify-content:center;transition:all .2s}
        .zoom-btn:hover{background:#fdece5}
        .zoom-label{font-size:13px;font-weight:700;color:#333;min-width:52px;text-align:center;background:#f8f8ff;border:1px solid #667799;border-radius:6px;padding:4px 8px}
        .add-more-btn{width:50px;height:50px;background:#eff6ef;color:#00079e;border:2px solid #667799;border-radius:50%;font-size:22px;cursor:pointer;transition:all .3s;display:flex;align-items:center;justify-content:center;margin:12px 0 0}
        .add-more-btn:hover{background:#fdece5;border-color:#00079e}
        .controls-panel{width:380px;background:#fff;border:1px solid #667799;border-radius:12px;padding:25px;height:fit-content;position:sticky;top:100px;display:flex;flex-direction:column}
        .controls-panel h2{font-size:24px;font-weight:900;color:#333;margin:0 0 5px}
        .controls-subtitle{font-size:14px;color:#00079e;background:#eff6ef;padding:6px 10px;border-radius:6px;border:1px solid #667799;margin:0 0 20px;display:inline-block}
        .tabs-header{display:flex;margin:0 0 20px;border-bottom:2px solid #bdbdbd}
        .tab-btn{flex:1;background:transparent;border:none;border-bottom:3px solid transparent;font-size:13px;font-weight:700;color:#667799;cursor:pointer;padding:10px 5px;transition:all .3s;font-family:'Lora',serif;margin:0 0 -2px}
        .tab-btn:hover{color:#00079e}
        .tab-btn.active{color:#00079e;border-bottom:3px solid #00079e}
        .tab-content{display:none}
        .tab-content.active{display:block}
        .bg-mode-wrap{display:flex;gap:10px;margin:0 0 15px}
        .bg-mode-btn{flex:1;padding:10px 0;background:#f8f8ff;border:1px solid #bdbdbd;border-radius:8px;font-weight:700;cursor:pointer;font-size:14px;color:#333;font-family:'Lora',serif;transition:all .3s}
        .bg-mode-btn.active,.bg-mode-btn:hover{background:#eff6ef;border-color:#00079e;color:#00079e}
        .color-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:10px}
        .color-swatch{width:100%;aspect-ratio:1/1;border-radius:8px;cursor:pointer;border:2px solid #bdbdbd;transition:all .2s;position:relative}
        .color-swatch:hover{transform:scale(1.1);border-color:#667799}
        .color-swatch.active{border:3px solid #00079e;box-shadow:0 0 0 2px #eff6ef}
        .swatch-transparent{background-image:linear-gradient(45deg,#bdbdbd 25%,transparent 25%),linear-gradient(-45deg,#bdbdbd 25%,transparent 25%),linear-gradient(45deg,transparent 75%,#bdbdbd 75%),linear-gradient(-45deg,transparent 75%,#bdbdbd 75%);background-size:10px 10px;background-position:0 0,0 5px,5px -5px,-5px 0;background-color:#f8f8ff}
        .swatch-custom{display:flex;align-items:center;justify-content:center;background:#f8f8ff;border:2px dashed #667799;overflow:hidden}
        .swatch-custom input[type="color"]{position:absolute;width:100%;height:100%;border:none;cursor:pointer;opacity:0}
        .swatch-custom-icon{font-size:14px;color:#667799;pointer-events:none}
        .upload-bg-area{border:2px dashed #667799;border-radius:10px;padding:20px 15px;text-align:center;cursor:pointer;background:#f8f8ff;transition:all .3s}
        .upload-bg-area:hover{background:#fdece5;border-color:#00079e}
        .upload-bg-area i{font-size:28px;color:#00079e;margin:0 0 8px;display:block}
        .upload-bg-area span{font-size:14px;font-weight:700;color:#333}
        .tool-mode-wrap{display:flex;gap:12px;margin:0 0 20px}
        .tool-btn{flex:1;padding:15px 10px;background:#f8f8ff;border:2px solid #bdbdbd;border-radius:10px;font-weight:700;cursor:pointer;display:flex;flex-direction:column;align-items:center;gap:8px;color:#333;font-family:'Lora',serif;transition:all .3s;font-size:14px}
        .tool-btn i{font-size:22px;color:#667799}
        .tool-btn:hover,.tool-btn.active{background:#eff6ef;border-color:#00079e;color:#00079e}
        .tool-btn.active i,.tool-btn:hover i{color:#00079e}
        .slider-section label{font-size:14px;font-weight:700;display:flex;justify-content:space-between;align-items:center;margin:0 0 10px;color:#333}
        .slider-section label span{color:#00079e;background:#eff6ef;padding:2px 8px;border-radius:4px;font-size:13px;border:1px solid #667799}
        input[type="range"]{width:100%;accent-color:#00079e;cursor:pointer}
        .download-btn{width:100%;padding:16px 0;background:#eff6ef;color:#00079e;border:1px solid #667799;border-radius:50px;font-size:16px;font-weight:700;cursor:pointer;margin:20px 0 0;transition:all .3s;font-family:'Lora',serif;display:flex;align-items:center;justify-content:center;gap:8px}
        .download-btn:hover{background:#fdece5;transform:translateY(-2px)}
        .processing-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(248,248,255,.94);display:none;align-items:center;justify-content:center;z-index:9999}
        .processing-overlay.active{display:flex}
        .processing-box{background:#fff;border-radius:20px;padding:50px;text-align:center;max-width:480px;width:90%;border:1px solid #667799;box-shadow:0 20px 60px rgba(0,0,0,.15)}
        .processing-icon{font-size:70px;color:#00079e;margin:0 0 20px;animation:pulse 1.5s ease-in-out infinite}
        @keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.12)}}
        .processing-title{font-size:28px;font-weight:900;color:#333;margin:0 0 12px}
        .processing-title .highlight{background:#00079e;color:#fff;padding:2px 8px;border-radius:4px}
        .processing-text{font-size:14px;color:#00079e;background:#eff6ef;padding:10px 15px;border-radius:8px;border:1px solid #667799;font-weight:700;line-height:1.6}
        #footer-placeholder{border:1px solid #667799!important;width:100%;display:block;position:relative}
        @media(max-width:1024px){.workspace-container.active{flex-direction:column}.controls-panel{width:100%;position:static}}
    </style>
</head>
<body>
    <div id="header-placeholder"></div>

    <section class="section" style="margin:50px 0 0!important">
        <div class="row-container">
            <div class="ad-manager-placeholder ad-leaderboard" data-ad-type="leaderboard"></div>
        </div>
    </section>

    <section class="section-main">
        <div class="row-container">
            <div id="heroHeader" style="text-align:center;margin:0 0 30px">
                <h1 style="font-size:36px;font-weight:900;color:#333;margin:0 0 10px">Remove Image Background Online Free</h1>
                <p style="font-size:16px;color:#333;margin:0">100% Automatically. Edit, Erase, Restore and Add Custom Backgrounds. JPG, PNG, WebP Supported.</p>
            </div>

            <div class="upload-section-wrapper">
                <div id="uploadArea" class="upload-area">
                    <div class="upload-icon"><i class="fas fa-image"></i></div>
                    <div class="upload-text">+ Upload Image</div>
                    <div class="upload-subtext">or Drop file here — JPG, PNG, WebP Supported</div>
                    <input type="file" id="fileInput" accept="image/jpeg,image/png,image/webp" style="display:none">
                </div>

                <div id="workspace" class="workspace-container">
                    <div class="preview-panel">
                        <div class="canvas-wrapper" id="canvasWrapper">
                            <canvas id="editorCanvas"></canvas>
                        </div>
                        <div class="zoom-controls">
                            <button class="zoom-btn" id="zoomOutBtn" title="Zoom Out (-)"><i class="fas fa-minus"></i></button>
                            <span class="zoom-label" id="zoomLabel">100%</span>
                            <button class="zoom-btn" id="zoomInBtn" title="Zoom In (+)"><i class="fas fa-plus"></i></button>
                            <button class="zoom-btn" id="zoomResetBtn" title="Reset Zoom (0)"><i class="fas fa-compress-arrows-alt"></i></button>
                        </div>
                        <button class="add-more-btn" id="addMoreBtn" title="Upload New Image"><i class="fas fa-plus"></i></button>
                    </div>

                    <div class="controls-panel">
                        <h2>Remove Background</h2>
                        <div class="controls-subtitle">Edit Your Image Below</div>
                        <div class="tabs-header">
                            <button class="tab-btn active" data-tab="tabBackground">Background</button>
                            <button class="tab-btn" data-tab="tabErase">Erase / Restore</button>
                            <button class="tab-btn" data-tab="tabAdjust">Adjust</button>
                        </div>

                        <div id="tabBackground" class="tab-content active">
                            <div class="bg-mode-wrap">
                                <button class="bg-mode-btn active" id="btnBgColor">Color</button>
                                <button class="bg-mode-btn" id="btnBgPhoto">Photo</button>
                            </div>
                            <div id="bgColorSection">
                                <div class="color-grid">
                                    <div class="color-swatch swatch-transparent active" data-color="transparent"></div>
                                    <div class="color-swatch" style="background:#333" data-color="#333333"></div>
                                    <div class="color-swatch" style="background:#00079e" data-color="#00079e"></div>
                                    <div class="color-swatch" style="background:#667799" data-color="#667799"></div>
                                    <div class="color-swatch" style="background:#fdece5" data-color="#fdece5"></div>
                                    <div class="color-swatch" style="background:#eff6ef" data-color="#eff6ef"></div>
                                    <div class="color-swatch" style="background:#f8f8ff" data-color="#f8f8ff"></div>
                                    <div class="color-swatch" style="background:#fff" data-color="#ffffff"></div>
                                    <div class="color-swatch" style="background:#bdbdbd" data-color="#bdbdbd"></div>
                                    <div class="color-swatch swatch-custom">
                                        <i class="fas fa-palette swatch-custom-icon"></i>
                                        <input type="color" id="customColorInput" value="#ff6600">
                                    </div>
                                </div>
                            </div>
                            <div id="bgPhotoSection" style="display:none">
                                <div class="upload-bg-area" id="uploadBgArea">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                    <span>Click to Upload Background Photo</span>
                                    <input type="file" id="bgPhotoInput" accept="image/*" style="display:none">
                                </div>
                            </div>
                        </div>

                        <div id="tabErase" class="tab-content">
                            <div class="tool-mode-wrap">
                                <button class="tool-btn active" id="btnErase"><i class="fas fa-eraser"></i> Erase</button>
                                <button class="tool-btn" id="btnRestore"><i class="fas fa-paint-brush"></i> Restore</button>
                            </div>
                            <div class="slider-section">
                                <label>Brush Size <span id="brushSizeVal">30</span></label>
                                <input type="range" id="brushSize" min="5" max="100" value="30">
                            </div>
                        </div>

                        <div id="tabAdjust" class="tab-content">
                            <div class="slider-section">
                                <label>Background Blur <span id="blurVal">0</span></label>
                                <input type="range" id="blurAmount" min="0" max="20" value="0">
                            </div>
                        </div>

                        <button class="download-btn" id="downloadBtn">Download Image <i class="fas fa-download"></i></button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="section-container" style="margin:40px 0!important;padding:0!important">
        <div class="row-container">
            <h2 style="font-weight:900;margin:0 0 25px!important;text-align:center!important;color:#333">How to Remove Image Background Online Free</h2>
            <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:20px;margin:0 0 40px">
                <div style="background:#fff;border:1px solid #667799;border-radius:12px;padding:24px 20px;text-align:center"><div style="font-size:36px;color:#00079e;margin:0 0 12px"><i class="fas fa-upload"></i></div><div style="font-size:16px;font-weight:700;color:#333;margin:0 0 8px">Step 1: Upload Image</div><div style="font-size:13px;color:#667799">Click Upload or drag and drop your JPG, PNG or WebP image.</div></div>
                <div style="background:#fff;border:1px solid #667799;border-radius:12px;padding:24px 20px;text-align:center"><div style="font-size:36px;color:#00079e;margin:0 0 12px"><i class="fas fa-magic"></i></div><div style="font-size:16px;font-weight:700;color:#333;margin:0 0 8px">Step 2: AI Removes BG</div><div style="font-size:13px;color:#667799">AI automatically detects and removes background inside your browser.</div></div>
                <div style="background:#fff;border:1px solid #667799;border-radius:12px;padding:24px 20px;text-align:center"><div style="font-size:36px;color:#00079e;margin:0 0 12px"><i class="fas fa-sliders-h"></i></div><div style="font-size:16px;font-weight:700;color:#333;margin:0 0 8px">Step 3: Edit and Enhance</div><div style="font-size:13px;color:#667799">Add custom background color or photo, erase or restore areas.</div></div>
                <div style="background:#fff;border:1px solid #667799;border-radius:12px;padding:24px 20px;text-align:center"><div style="font-size:36px;color:#00079e;margin:0 0 12px"><i class="fas fa-download"></i></div><div style="font-size:16px;font-weight:700;color:#333;margin:0 0 8px">Step 4: Download</div><div style="font-size:13px;color:#667799">Click Download to save your image as PNG or JPG.</div></div>
            </div>
        </div>
    </section>

    <section class="section-container" style="margin:40px 0!important;padding:0!important">
        <div class="row-container">
            <h2 style="font-weight:900;margin:0 0 25px!important;text-align:center!important;color:#333">Frequently Asked Questions</h2>
            <div class="faq-list">
                <div class="faq-item"><div class="faq-question" onclick="toggleFAQ(this)"><span>Is This Background Removal Tool Free?</span><i class="faq-icon">+</i></div><div class="faq-answer"><p>Yes, Our Remove Background Tool is Completely Free with No Limitations on File Size or Number of Images.</p></div></div>
                <div class="faq-item"><div class="faq-question" onclick="toggleFAQ(this)"><span>Which Image Formats are Supported?</span><i class="faq-icon">+</i></div><div class="faq-answer"><p>Our Tool Supports JPG, PNG and WebP Image Formats for Background Removal.</p></div></div>
                <div class="faq-item"><div class="faq-question" onclick="toggleFAQ(this)"><span>Is My Image Safe and Private?</span><i class="faq-icon">+</i></div><div class="faq-answer"><p>Yes, All Processing Happens Locally in Your Browser. Your Images Never Leave Your Device.</p></div></div>
                <div class="faq-item"><div class="faq-question" onclick="toggleFAQ(this)"><span>Can I Add a Custom Background After Removing?</span><i class="faq-icon">+</i></div><div class="faq-answer"><p>Yes, After Background Removal You Can Add a Solid Color, Upload a Custom Photo Background, or Apply a Blur Effect.</p></div></div>
            </div>
        </div>
    </section>

    <section class="section-main">
        <div class="row-custom">
            <div class="ad-manager-placeholder" data-ad-type="responsive"></div>
        </div>
    </section>

    <div id="processingOverlay" class="processing-overlay">
        <div class="processing-box">
            <div class="processing-icon"><i class="fas fa-magic"></i></div>
            <div class="processing-title"><span class="highlight">Removing</span> Background</div>
            <div class="processing-text" id="processingText">Please Wait. AI is Processing Your Image Locally.<br>Do Not Close Your Browser.</div>
        </div>
    </div>

    <div id="footer-placeholder"></div>
    <script src="../js/ad-manager.js"></script>
    <script src="../js/main.js"></script>

    <script>
        /* ── STATE ── */
        let originalImg = null;
        let fgCanvas    = document.createElement('canvas');
        let fgCtx       = fgCanvas.getContext('2d');
        let bgColor     = 'transparent';
        let bgPhotoImg  = null;
        let bgType      = 'color';
        let currentTool = 'erase';
        let isDrawing   = false;
        let blurValue   = 0;
        let tfModule    = null;
        let bgModel     = null;
        let bgProc      = null;

        /* ── ZOOM STATE ── */
        let zoom      = 1, panX = 0, panY = 0;
        let isPanning = false, panSX = 0, panSY = 0;
        let spaceHeld = false;
        const MIN_Z   = 0.25, MAX_Z = 8;

        /* ── DOM ── */
        const uploadArea        = document.getElementById('uploadArea');
        const fileInput         = document.getElementById('fileInput');
        const workspace         = document.getElementById('workspace');
        const processingOverlay = document.getElementById('processingOverlay');
        const processingText    = document.getElementById('processingText');
        const editorCanvas      = document.getElementById('editorCanvas');
        const eCtx              = editorCanvas.getContext('2d');
        const cWrap             = document.getElementById('canvasWrapper');
        const addMoreBtn        = document.getElementById('addMoreBtn');
        const downloadBtn       = document.getElementById('downloadBtn');
        const brushSizeInput    = document.getElementById('brushSize');
        const blurInput         = document.getElementById('blurAmount');
        const bgPhotoInput      = document.getElementById('bgPhotoInput');
        const customColorInput  = document.getElementById('customColorInput');

        /* ── UPLOAD TRIGGERS ── */
        uploadArea.addEventListener('click',     () => fileInput.click());
        addMoreBtn.addEventListener('click',     resetTool);
        fileInput.addEventListener('change',     e => { if (e.target.files[0]) handleUpload(e.target.files[0]); fileInput.value = ''; });
        uploadArea.addEventListener('dragover',  e => { e.preventDefault(); uploadArea.classList.add('dragover'); });
        uploadArea.addEventListener('dragleave', () => uploadArea.classList.remove('dragover'));
        uploadArea.addEventListener('drop', e => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const f = Array.from(e.dataTransfer.files).find(f => /^image\/(jpeg|png|webp)$/.test(f.type));
            if (f) handleUpload(f);
            else alert('Please Upload a Valid JPG, PNG or WebP File.');
        });

        /* ── ZOOM FUNCTIONS ── */
        function applyZoom() {
            editorCanvas.style.transform       = `translate(${panX}px,${panY}px) scale(${zoom})`;
            editorCanvas.style.transformOrigin = '0 0';
            document.getElementById('zoomLabel').textContent = Math.round(zoom * 100) + '%';
        }

        function setZoom(val, cx, cy) {
            const rect = cWrap.getBoundingClientRect();
            const ox   = (cx !== undefined) ? cx - rect.left : rect.width  / 2;
            const oy   = (cy !== undefined) ? cy - rect.top  : rect.height / 2;
            const nz   = Math.min(MAX_Z, Math.max(MIN_Z, val));
            panX = ox - (ox - panX) * (nz / zoom);
            panY = oy - (oy - panY) * (nz / zoom);
            zoom = nz;
            applyZoom();
        }

        document.getElementById('zoomInBtn').addEventListener('click',    () => setZoom(zoom + 0.25));
        document.getElementById('zoomOutBtn').addEventListener('click',   () => setZoom(zoom - 0.25));
        document.getElementById('zoomResetBtn').addEventListener('click', () => { zoom = 1; panX = 0; panY = 0; applyZoom(); });

        cWrap.addEventListener('wheel', e => {
            e.preventDefault();
            setZoom(zoom * (e.deltaY < 0 ? 1.1 : 0.9), e.clientX, e.clientY);
        }, { passive: false });

        /* ── KEYBOARD SHORTCUTS ── */
        document.addEventListener('keydown', e => {
            if (!workspace.classList.contains('active')) return;
            if (e.key === '+' || e.key === '=') { e.preventDefault(); setZoom(zoom + 0.25); }
            if (e.key === '-')                  { e.preventDefault(); setZoom(zoom - 0.25); }
            if (e.key === '0')                  { e.preventDefault(); zoom = 1; panX = 0; panY = 0; applyZoom(); }
            if (e.code === 'Space')             { e.preventDefault(); spaceHeld = true; cWrap.style.cursor = 'grab'; }
        });
        document.addEventListener('keyup', e => {
            if (e.code === 'Space') { spaceHeld = false; cWrap.style.cursor = 'grab'; }
        });

        /* ── PAN ── */
        cWrap.addEventListener('mousedown', e => {
            if (e.button === 1 || spaceHeld) {
                isPanning = true;
                panSX = e.clientX - panX;
                panSY = e.clientY - panY;
                e.preventDefault();
            }
        });
        window.addEventListener('mousemove', e => {
            if (!isPanning) return;
            panX = e.clientX - panSX;
            panY = e.clientY - panSY;
            applyZoom();
        });
        window.addEventListener('mouseup', e => {
            if (e.button === 1 || spaceHeld) isPanning = false;
        });

        /* ── LOAD AI ── */
        async function loadAI() {
            if (bgModel && bgProc) return;
            processingText.innerHTML = 'Loading AI Model...<br>First Time May Take 1-2 Minutes.';
            tfModule = await import('https://cdn.jsdelivr.net/npm/@xenova/transformers@2.17.2/dist/transformers.min.js');
            tfModule.env.allowLocalModels = false;
            tfModule.env.useBrowserCache  = true;
            [bgProc, bgModel] = await Promise.all([
                tfModule.AutoProcessor.from_pretrained('briaai/RMBG-1.4'),
                tfModule.AutoModel.from_pretrained('briaai/RMBG-1.4', { config: { model_type: 'custom' } })
            ]);
        }

        /* ── MAIN HANDLER ── */
        async function handleUpload(file) {
            processingOverlay.classList.add('active');
            processingText.innerHTML = 'Please Wait. AI is Processing Your Image Locally.<br>Do Not Close Your Browser.';
            try {
                const objUrl = URL.createObjectURL(file);
                originalImg  = new Image();
                await new Promise((res, rej) => { originalImg.onload = res; originalImg.onerror = rej; originalImg.src = objUrl; });

                const W = originalImg.naturalWidth;
                const H = originalImg.naturalHeight;
                editorCanvas.width  = fgCanvas.width  = W;
                editorCanvas.height = fgCanvas.height = H;

                await loadAI();
                processingText.innerHTML = 'Removing Background...<br>Please Wait.';

                const image            = await tfModule.RawImage.fromURL(objUrl);
                const { pixel_values } = await bgProc(image);
                const { output }       = await bgModel({ input: pixel_values });
                const mask             = await tfModule.RawImage.fromTensor(output[0].mul(255).to('uint8')).resize(W, H);

                const tmp     = document.createElement('canvas');
                tmp.width     = W; tmp.height = H;
                const tmpCtx  = tmp.getContext('2d');
                tmpCtx.drawImage(originalImg, 0, 0);
                const imgData = tmpCtx.getImageData(0, 0, W, H);
                for (let i = 0; i < mask.data.length; i++) imgData.data[4 * i + 3] = mask.data[i];
                tmpCtx.putImageData(imgData, 0, 0);

                fgCtx.clearRect(0, 0, W, H);
                fgCtx.drawImage(tmp, 0, 0);
                URL.revokeObjectURL(objUrl);

                /* Reset zoom on new image */
                zoom = 1; panX = 0; panY = 0; applyZoom();

                uploadArea.style.display = 'none';
                workspace.classList.add('active');
                renderCanvas();
            } catch (err) {
                console.error('Error:', err);
                alert('Error: ' + err.message);
            } finally {
                processingOverlay.classList.remove('active');
            }
        }

        /* ── RENDER ── */
        function renderCanvas() {
            if (!originalImg) return;
            eCtx.clearRect(0, 0, editorCanvas.width, editorCanvas.height);
            eCtx.save();
            if (blurValue > 0) eCtx.filter = `blur(${blurValue}px)`;
            if (bgType === 'color' && bgColor !== 'transparent') {
                eCtx.fillStyle = bgColor;
                eCtx.fillRect(0, 0, editorCanvas.width, editorCanvas.height);
            } else if (bgType === 'photo' && bgPhotoImg) {
                const sc = Math.max(editorCanvas.width / bgPhotoImg.naturalWidth, editorCanvas.height / bgPhotoImg.naturalHeight);
                const x  = (editorCanvas.width  - bgPhotoImg.naturalWidth  * sc) / 2;
                const y  = (editorCanvas.height - bgPhotoImg.naturalHeight * sc) / 2;
                eCtx.drawImage(bgPhotoImg, x, y, bgPhotoImg.naturalWidth * sc, bgPhotoImg.naturalHeight * sc);
            }
            eCtx.restore();
            eCtx.drawImage(fgCanvas, 0, 0);
        }

        /* ── BRUSH — coordinates corrected for zoom/pan ── */
        function getPos(e) {
            const rect = editorCanvas.getBoundingClientRect();
            const cx   = e.touches ? e.touches[0].clientX : e.clientX;
            const cy   = e.touches ? e.touches[0].clientY : e.clientY;
            return {
                x: (cx - rect.left) * (editorCanvas.width  / rect.width),
                y: (cy - rect.top)  * (editorCanvas.height / rect.height)
            };
        }

        function applyBrush(e) {
            if (!isDrawing || spaceHeld || isPanning) return;
            e.preventDefault();
            const { x, y } = getPos(e);
            const r = parseInt(brushSizeInput.value) / zoom;
            if (currentTool === 'erase') {
                fgCtx.globalCompositeOperation = 'destination-out';
                fgCtx.beginPath(); fgCtx.arc(x, y, r, 0, Math.PI * 2); fgCtx.fill();
            } else {
                fgCtx.globalCompositeOperation = 'source-over';
                fgCtx.save();
                fgCtx.beginPath(); fgCtx.arc(x, y, r, 0, Math.PI * 2); fgCtx.clip();
                fgCtx.drawImage(originalImg, 0, 0);
                fgCtx.restore();
            }
            fgCtx.globalCompositeOperation = 'source-over';
            renderCanvas();
        }

        editorCanvas.addEventListener('mousedown',  e => { if (!spaceHeld && e.button === 0) { isDrawing = true; applyBrush(e); } });
        editorCanvas.addEventListener('mousemove',  applyBrush);
        window.addEventListener('mouseup',          () => isDrawing = false);
        editorCanvas.addEventListener('touchstart', e => { isDrawing = true; applyBrush(e); }, { passive: false });
        editorCanvas.addEventListener('touchmove',  applyBrush, { passive: false });
        window.addEventListener('touchend',         () => isDrawing = false);

        /* ── TABS ── */
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', function () {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
                this.classList.add('active');
                document.getElementById(this.dataset.tab).classList.add('active');
            });
        });

        /* ── BACKGROUND ── */
        document.getElementById('btnBgColor').addEventListener('click', () => switchBgMode('color'));
        document.getElementById('btnBgPhoto').addEventListener('click', () => switchBgMode('photo'));

        function switchBgMode(mode) {
            bgType = mode;
            document.getElementById('btnBgColor').classList.toggle('active', mode === 'color');
            document.getElementById('btnBgPhoto').classList.toggle('active', mode === 'photo');
            document.getElementById('bgColorSection').style.display = mode === 'color' ? 'block' : 'none';
            document.getElementById('bgPhotoSection').style.display = mode === 'photo' ? 'block' : 'none';
            renderCanvas();
        }

        document.querySelectorAll('.color-swatch[data-color]').forEach(s => {
            s.addEventListener('click', function () {
                document.querySelectorAll('.color-swatch').forEach(s => s.classList.remove('active'));
                this.classList.add('active');
                bgColor = this.dataset.color;
                renderCanvas();
            });
        });

        customColorInput.addEventListener('input', e => {
            document.querySelectorAll('.color-swatch').forEach(s => s.classList.remove('active'));
            bgColor = e.target.value;
            renderCanvas();
        });

        document.getElementById('uploadBgArea').addEventListener('click', () => bgPhotoInput.click());
        bgPhotoInput.addEventListener('change', e => {
            const f = e.target.files[0]; if (!f) return;
            bgPhotoImg        = new Image();
            bgPhotoImg.onload = renderCanvas;
            bgPhotoImg.src    = URL.createObjectURL(f);
        });

        /* ── ERASE / RESTORE ── */
        document.getElementById('btnErase').addEventListener('click',   () => setTool('erase'));
        document.getElementById('btnRestore').addEventListener('click', () => setTool('restore'));

        function setTool(tool) {
            currentTool = tool;
            document.getElementById('btnErase').classList.toggle('active',   tool === 'erase');
            document.getElementById('btnRestore').classList.toggle('active', tool === 'restore');
        }

        brushSizeInput.addEventListener('input', () => {
            document.getElementById('brushSizeVal').textContent = brushSizeInput.value;
        });

        /* ── BLUR ── */
        blurInput.addEventListener('input', () => {
            blurValue = parseInt(blurInput.value);
            document.getElementById('blurVal').textContent = blurValue;
            renderCanvas();
        });

        /* ── DOWNLOAD ── */
        downloadBtn.addEventListener('click', () => {
            const isTransparent = bgType === 'color' && bgColor === 'transparent';
            const mime = isTransparent ? 'image/png' : 'image/jpeg';
            const ext  = isTransparent ? 'png'       : 'jpeg';
            const a    = document.createElement('a');
            a.href     = editorCanvas.toDataURL(mime, 1.0);
            a.download = `removed-bg-rojgarsangam.${ext}`;
            document.body.appendChild(a); a.click(); document.body.removeChild(a);
        });

        /* ── RESET ── */
        function resetTool() {
            originalImg  = null; bgPhotoImg = null;
            bgColor      = 'transparent'; bgType = 'color';
            currentTool  = 'erase'; blurValue = 0;
            blurInput.value = 0; brushSizeInput.value = 30;
            document.getElementById('blurVal').textContent      = '0';
            document.getElementById('brushSizeVal').textContent = '30';
            fgCtx.clearRect(0, 0, fgCanvas.width, fgCanvas.height);
            eCtx.clearRect(0, 0, editorCanvas.width, editorCanvas.height);
            workspace.classList.remove('active');
            uploadArea.style.display = 'block';
            zoom = 1; panX = 0; panY = 0; applyZoom();
            switchBgMode('color');
            document.querySelectorAll('.color-swatch').forEach(s => s.classList.remove('active'));
            document.querySelector('.swatch-transparent').classList.add('active');
            setTool('erase');
        }
    </script>
</body>
</html>
